# Default playbook.
#
# Should configure a development setup to the point where a server or
# equivalent can be started with a single command.
---

- hosts: all

  become: true
  become_method: sudo
  become_user: root

  pre_tasks:
    - name: Update apt cache (if old)
      apt: update_cache=yes cache_valid_time=84600
      changed_when: false

  vars:

    # NOTE: it is currently not possible to change the hostnames without
    # issuing new certificates manually

    hostname: dh.example.org
    idp_hostname: idp.example.org
    sp_hostname: sp.example.org
    certificate_dh: /etc/ssl/certs/dh.crt
    certificate_key_dh: /etc/ssl/private/dh.key
    certificate_ca_file: /etc/ssl/certs/ca-certificates.crt
    saml_mellonUser: "urn:oid:0.9.2342.19200300.100.1.1"
    saml_mellonOrganizationName: Example Organization
    saml_mellonOrganizationUrl: dh.example.org
    saml_mellonSPCertFile: /var/simplesamlphp/cert/sp.crt
    saml_mellonSPPrivateKeyFile: /var/simplesamlphp/cert/sp.key
    saml_mellonIdPMetadataFile: /etc/apache2/mellon/idp-metadata.xml

  roles:
    - common-server-configuration
    - apache
    - simplesamlphp

...
